var e,t,s=Object.defineProperty,n=(e,t,n)=>(((e,t,n)=>{t in e?s(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n})(e,"symbol"!=typeof t?t+"":t,n),n);import{e as r}from"./events.js";import{J as i}from"./ethers-vendor.js";import"./react-vendor.js";class a extends r.EventEmitter{constructor(){super(),n(this,"isInitialized",!1),n(this,"accounts",[]),n(this,"chainId","0xaa36a7"),n(this,"rpcUrl","https://sepolia.infura.io/v3/6131105f1e4c4841a297c5392effa977"),n(this,"_eventEmitter"),n(this,"ethersProvider"),this._eventEmitter=new r.EventEmitter,this.ethersProvider=new i(this.rpcUrl),this.initialize()}async initialize(){try{this.injectProvider();if(!(await this.sendMessage("checkPermission",{method:"web3"})))return;this.isInitialized=!0;const[e,t]=await Promise.all([this.sendMessage("eth_accounts",{}),this.sendMessage("eth_chainId",{})]);this.accounts=(null==e?void 0:e.accounts)||[],this.chainId=(null==t?void 0:t.chainId)||"0x1",this.accounts.length>0&&(this._eventEmitter.emit("connect",{chainId:this.chainId}),this._eventEmitter.emit("accountsChanged",this.accounts))}catch(e){}}injectProvider(){const e={isFreoWallet:!0,request:async e=>{try{switch(e.method){case"eth_chainId":return this.chainId;case"eth_accounts":return this.accounts;case"eth_blockNumber":return(await this.ethersProvider.getBlockNumber()).toString();case"eth_getBalance":{const[t,s]=e.params||[];return(await this.ethersProvider.getBalance(t,s)).toHexString()}default:return await this.sendMessage(e.method,{params:e.params})}}catch(t){if(t instanceof Error)throw new Error(`FreoBus: ${t.message}`);throw new Error("FreoBus: Unknown error")}},send:async(e,t)=>{try{t(null,await this.sendMessage(e.method,{params:e.params}))}catch(s){t(s,null)}},on:(e,t)=>{this._eventEmitter.on(e,t)},removeListener:(e,t)=>{this._eventEmitter.removeListener(e,t)},isConnected:()=>this.isInitialized,chainId:this.chainId,selectedAddress:this.accounts[0]||null,_eventEmitter:this._eventEmitter};window.ethereum=e,window.FreoBus=e}async sendMessage(e,t){return new Promise(((s,n)=>{chrome.runtime.sendMessage({type:e,data:t},(e=>{chrome.runtime.lastError?n(chrome.runtime.lastError):e.success?s(e.value):n(new Error(e.error))}))}))}}(null==(e=globalThis.browser)?void 0:e.tabs)||null==(t=globalThis.chrome)||t.tabs;var o=async e=>(()=>{var e,t;let s=(null==(e=globalThis.browser)?void 0:e.runtime)||(null==(t=globalThis.chrome)?void 0:t.runtime);if(!s)throw new Error("Extension runtime is not available");return s})().sendMessage(e.extensionId??null,e);async function c(e){return await o({name:"wallet",body:{type:"SWITCH_CHAIN",payload:{origin:window.location.origin,chainId:e}}})}!function(){const e=document.createElement("script");e.src=chrome.runtime.getURL("assets/inpage.js"),e.type="text/javascript",e.async=!1,(document.head||document.documentElement).appendChild(e),e.onload=()=>{e.remove()}}(),new a;new MutationObserver((()=>{var e;const t=document.querySelector(".network-badge");if(t){const s=null==(e=t.textContent)?void 0:e.toLowerCase();(null==s?void 0:s.includes("polygon"))?c("0x89"):(null==s?void 0:s.includes("ethereum"))&&c("0x1")}})).observe(document.body,{childList:!0,subtree:!0}),window.addEventListener("message",(async e=>{var t;if(e.source!==window)return;if("FREOBUS_REQUEST"!==(null==(t=e.data)?void 0:t.type))return;const{id:s,args:n}=e.data;try{const e=await o({name:"wallet",body:{type:n.method,payload:n.params}});window.postMessage({type:"FREOBUS_RESPONSE",id:s,result:e},"*")}catch(r){window.postMessage({type:"FREOBUS_RESPONSE",id:s,error:r instanceof Error?r.message:String(r)},"*")}}));
